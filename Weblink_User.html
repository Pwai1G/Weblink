<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quick Link</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Poppins", sans-serif;
        background-color: #f8f9fa;
        color: #333;
      }
      .container {
        height: auto;
        padding: 1px;
        display: flex;
      }

      .left {
        width: 80%;
        padding: 20px;
        overflow-y: auto;
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .right {
        width: auto;
        background-color: #f4f4f4;
        padding: 20px;
        font-size: 12px;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      table {
        width: 90%;
        border-collapse: collapse;
        margin: 10px auto;
      }

      th,
      td {
        border: 1px solid black;
        padding: 10px;
        text-align: center;
        width: 80%;
      }

      th {
        background-color: #f4f4f4;
        cursor: pointer;
      }

      button {
        background: linear-gradient(135deg, #007bff, #0056b3);
        color: white;
        padding: 5px 8px;
        border-radius: 10px;
        transition: all 0.3s ease-in-out;
        cursor: pointer;
      }

      button:hover {
        background-color: #0056b3;
        background: linear-gradient(135deg, #0056b3, #003f7f);
        transform: scale(1.05);
      }

      .form-container {
        margin-top: 20px;
        text-align: left;
      }

      select,
      input[type="text"],
      input[type="url"] {
        margin: 5px;
        padding: 8px;
        width: 200px;
      }

      .form-container button {
        margin-left: 10px;
      }

      .add-table-container {
        margin-top: 20px;
        text-align: center;
      }

      .delete-table-button {
        margin-top: 10px;
      }

      .status-message {
        margin-top: 20px;
        padding: 10px;
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
        border-radius: 5px;
        text-align: center;
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="left">
        <h2 style="text-align: center; display: inline-block">
          Link Management
        </h2>
        <button id="refreshButton" onclick="refreshPage()">üîÑ Refresh</button>
        <div id="tables-container"></div>
      </div>

      <div class="right">
        <h2>Manage Table/Link</h2>

        <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏° Filter Table ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á Manage Table/Link -->
        <h3>Filter Table</h3>
        <input
          type="text"
          id="filterInput"
          placeholder="Enter keyword to filter"
          onkeyup="filterTables()"
        />

        <script>
          function filterTables() {
            const keyword = document
              .getElementById("filterInput")
              .value.toLowerCase();
            const headings = document.querySelectorAll(".left h2");

            headings.forEach((heading) => {
              const table = heading.nextElementSibling;
              if (table && table.tagName.toLowerCase() === "table") {
                if (heading.textContent.toLowerCase().includes(keyword)) {
                  heading.style.display = "";
                  table.style.display = "";
                } else {
                  heading.style.display = "none";
                  table.style.display = "none";
                }
              }
            });
          }
        </script>

        <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏° Export ‡πÅ‡∏•‡∏∞ Import -->
        <h3>Manage Data</h3>
        <button onclick="exportData()">Export</button>
        <button onclick="importData()">Import</button>
        <div><br /></div>
        <button onclick="importDefaultData()">Import Default</button>
        <input type="file" id="importFile" style="display: none" />

        <div><br /></div>
        <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏° Clear Screen -->
        <h3>Clear Screen</h3>
        <button onclick="clearScreen()">Clear Screen</button>
        <div><br /></div>
      </div>
    </div>
    <div class="status-message" id="statusMessage"></div>

    <script>

        const tables = JSON.parse(localStorage.getItem("tables")) || [];
        const links = JSON.parse(localStorage.getItem("links")) || {};

        tables.forEach((tableName) => {
          createTable(tableName, links[tableName] || []);
        });

        updateTableSelect();
      };

      function createTable(tableName, links) {
        const leftSection = document.querySelector(".left");
        const newTableHeading = document.createElement("h2");
        newTableHeading.textContent = tableName;
        leftSection.appendChild(newTableHeading);

        const newTable = document.createElement("table");
        newTable.id = tableName;
        newTable.innerHTML = `
          <thead>
              <tr>
                  <th onclick="sortTable('${tableName}')">Name ‚¨ç</th>
                  <th>Link</th>
              </tr>
          </thead>
          <tbody>
            ${links
              .map(
                (link) =>
                  `<tr><td>${link.name}</td><td><button onclick="window.open('${link.url}', '_blank')">Click</button></td></tr>`
              )
              .join("")}
          </tbody>
        `;
        leftSection.appendChild(newTable);
      }

      function updateTableSelect() {
        const select = document.getElementById("tableSelect");
        const tableDeleteSelect = document.getElementById("tableDeleteSelect");

        const tables = JSON.parse(localStorage.getItem("tables")) || [];

        select.innerHTML = "";
        tableDeleteSelect.innerHTML = "";
        tables.forEach((tableName) => {
          const option = document.createElement("option");
          option.value = tableName;
          option.textContent = tableName;
          select.appendChild(option);

          const deleteOption = document.createElement("option");
          deleteOption.value = tableName;
          deleteOption.textContent = tableName;
          tableDeleteSelect.appendChild(deleteOption);
        });
      }

      function sortTable(tableId) {
        const table = document.getElementById(tableId);
        const tbody = table.querySelector("tbody");
        const rows = Array.from(tbody.querySelectorAll("tr"));

        let ascending = table.dataset.ascending === "true";

        rows.sort((rowA, rowB) => {
          const nameA = rowA.cells[0].textContent.trim().toLowerCase();
          const nameB = rowB.cells[0].textContent.trim().toLowerCase();
          return ascending
            ? nameA.localeCompare(nameB)
            : nameB.localeCompare(nameA);
        });

        tbody.innerHTML = "";
        rows.forEach((row) => tbody.appendChild(row));

        table.dataset.ascending = !ascending;
        const th = table.querySelector("th");
        th.textContent = ascending ? "Name ‚¨ÜÔ∏è" : "Name ‚¨áÔ∏è";
      }

      function addLink() {
        const tableId = document.getElementById("tableSelect").value;
        const table = document.getElementById(tableId);
        const linkName = document.getElementById("linkName").value;
        const linkURL = document.getElementById("linkURL").value;

        if (linkName && linkURL) {
          const fullURL = linkURL.startsWith("http")
            ? linkURL
            : "http://" + linkURL;

          const newRow = table.querySelector("tbody").insertRow();
          newRow.innerHTML = `
            <td>${linkName}</td>
            <td><button onclick="window.open('${fullURL}', '_blank')">Click</button></td>
          `;

          let links = JSON.parse(localStorage.getItem("links")) || {};
          if (!links[tableId]) {
            links[tableId] = [];
          }
          links[tableId].push({ name: linkName, url: fullURL });
          localStorage.setItem("links", JSON.stringify(links));

          showStatusMessage(`‡∏•‡∏¥‡∏á‡∏Å‡πå '${linkName}' ‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß`);
        } else {
          showStatusMessage("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞ URL ‡∏Ç‡∏≠‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå");
        }
      }

      function deleteLink() {
        const tableId = document.getElementById("tableSelect").value;
        const table = document.getElementById(tableId);
        const linkName = document.getElementById("linkName").value;

        const row = [...table.rows].find(
          (row) => row.cells[0].textContent === linkName
        );

        if (row) {
          const confirmDelete = window.confirm(
            `‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå '${linkName}'?`
          );
          if (confirmDelete) {
            row.remove();
            showStatusMessage(`‡∏•‡∏¥‡∏á‡∏Å‡πå '${linkName}' ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß`);

            let links = JSON.parse(localStorage.getItem("links")) || {};
            links[tableId] = links[tableId].filter(
              (link) => link.name !== linkName
            );
            localStorage.setItem("links", JSON.stringify(links));
          } else {
            showStatusMessage("‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å");
          }
        } else {
          showStatusMessage("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö");
        }
      }

      function addTable() {
        const tableName = document.getElementById("newTableName").value;

        if (tableName) {
          const confirmAddTable = window.confirm(
            `‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ä‡∏∑‡πà‡∏≠ '${tableName}'?`
          );
          if (confirmAddTable) {
            const newTable = document.createElement("table");
            newTable.id = tableName;
            newTable.innerHTML = `
              <thead>
                  <tr>
                      <th onclick="sortTable('${tableName}')">Name ‚¨ç</th>
                      <th>Link</th>
                  </tr>
              </thead>
              <tbody></tbody>
            `;
            document.querySelector(".left").appendChild(newTable);

            const tables = JSON.parse(localStorage.getItem("tables")) || [];
            tables.push(tableName);
            localStorage.setItem("tables", JSON.stringify(tables));

            updateTableSelect();

            showStatusMessage(`‡∏ï‡∏≤‡∏£‡∏≤‡∏á '${tableName}' ‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß`);
          }
        } else {
          showStatusMessage("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á");
        }
      }

      function deleteTable() {
        const tableName = document.getElementById("tableDeleteSelect").value;

        if (tableName) {
          const confirmDeleteTable = window.confirm(
            `‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á '${tableName}'?`
          );
          if (confirmDeleteTable) {
            const table = document.getElementById(tableName);
            if (table) {
              table.remove();

              let tables = JSON.parse(localStorage.getItem("tables")) || [];
              tables = tables.filter((table) => table !== tableName);
              localStorage.setItem("tables", JSON.stringify(tables));

              updateTableSelect();

              showStatusMessage(`‡∏ï‡∏≤‡∏£‡∏≤‡∏á '${tableName}' ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß`);
            }
          } else {
            showStatusMessage("‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å");
          }
        } else {
          showStatusMessage("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö");
        }
      }

      function exportData() {
        const tables = JSON.parse(localStorage.getItem("tables")) || [];
        const links = JSON.parse(localStorage.getItem("links")) || {};

        const data = {
          tables: tables,
          links: links,
        };

        const blob = new Blob([JSON.stringify(data, null, 2)], {
          type: "application/json",
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "table_data.json";
        a.click();
        URL.revokeObjectURL(url);

        showStatusMessage("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å Export ‡πÅ‡∏•‡πâ‡∏ß");
      }

      function importData() {
        const fileInput = document.getElementById("importFile");
        fileInput.click();

        fileInput.onchange = function (event) {
          const file = event.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
              try {
                const data = JSON.parse(e.target.result);
                localStorage.setItem("tables", JSON.stringify(data.tables));
                localStorage.setItem("links", JSON.stringify(data.links));

                // Reload the page to reflect the changes
                window.location.reload();
              } catch (error) {
                showStatusMessage("‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
              }
            };
            reader.readAsText(file);
          }
        };
      }

      function showStatusMessage(message) {
        const statusMessage = document.getElementById("statusMessage");
        statusMessage.textContent = message;
        statusMessage.style.display = "block";
        setTimeout(() => {
          statusMessage.style.display = "none";
        }, 3000);
      }

      function clearScreen() {
        const confirmClear = window.confirm(
          "‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î? ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏•‡∏ö‡∏ó‡∏∏‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏•‡∏¥‡∏á‡∏Å‡πå!"
        );
        if (confirmClear) {
          // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô localStorage
          localStorage.removeItem("tables");
          localStorage.removeItem("links");

          // ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
          window.location.reload();
        }
      }

      function importDefaultData() {
        fetch("https://pwai1g.github.io/Weblink/Default_List.json")
          .then((response) => response.json())
          .then((data) => {
            if (data.tables && data.links) {
              localStorage.setItem("tables", JSON.stringify(data.tables));
              localStorage.setItem("links", JSON.stringify(data.links));

              showStatusMessage("Import Default ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!");
              window.location.reload(); // ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á
            } else {
              showStatusMessage("‡πÑ‡∏ü‡∏•‡πå Default_List.JSON ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!");
            }
          })
          .catch((error) => {
            console.error("Error loading Default_List.JSON:", error);
            showStatusMessage("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î Default_List.JSON");
          });
      }

      function refreshPage() {
        location.reload(); // ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà
      }
    </script>
  </body>
</html>
