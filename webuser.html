<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebLinkUser</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Poppins", sans-serif;
        background-color: #f8f9fa;
        color: #333;
      }
      .container {
        height: auto;
        padding: 1px;
        display: flex;
      }

      .left {
        width: 80%;
        padding: 20px;
        overflow-y: auto;
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .right {
        width: auto;
        background-color: #f4f4f4;
        padding: 20px;
        font-size: 12px;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin: 10px 0;
      }

      th,
      td {
        border: 1px solid black;
        padding: 10px;
        text-align: center;
        width: 80%;
      }

      th {
        background-color: #f4f4f4;
      }

      button {
        background: linear-gradient(135deg, #007bff, #0056b3);
        color: white;
        padding: 8px 12px;
        border: none;
        border-radius: 10px;
        transition: all 0.3s ease-in-out;
        cursor: pointer;
      }

      button:hover {
        background: linear-gradient(135deg, #0056b3, #003f7f);
        transform: scale(1.05);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="left">
        <h2 style="text-align: center; display: inline-block">
          Link Management
        </h2>
        <button id="refreshButton" onclick="refreshPage()">ðŸ”„ Refresh</button>
        <div id="tables-container"></div>
      </div>

      <div class="right">
        <h2>Manage Data</h2>

        <input
          type="file"
          id="importFile"
          style="display: none"
          accept=".json"
        />
        <button onclick="importDefaultData()">Import Link</button>
        <h3>Clear Screen</h3>
        <button onclick="clearScreen()">Clear Screen</button>
        <h3>Clear Cache</h3>
        <button onclick="clearCache()">Clear Cache</button>
        <div><br /></div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        console.log("âœ… JavaScript Loaded!");
        document
          .getElementById("refreshButton")
          .addEventListener("click", function () {
            location.reload();
          });
        loadTables();
      });

      function loadTables() {
        const tablesContainer = document.getElementById("tables-container");
        const tables = JSON.parse(localStorage.getItem("tables")) || [];
        const links = JSON.parse(localStorage.getItem("links")) || {};
        tablesContainer.innerHTML = "";
        tables.forEach((tableName) => {
          const tableDiv = document.createElement("div");
          tableDiv.innerHTML = `<h3>${tableName}</h3>`;

          const table = document.createElement("table");
          table.innerHTML = `
            <thead>
              <tr>
                <th>Name</th>
                <th>Link</th>
              </tr>
            </thead>
            <tbody>
              ${
                links[tableName]
                  ? links[tableName]
                      .map(
                        (link) => `
                <tr>
                  <td>${link.name}</td>
                  <td><button onclick="window.open('${link.url}', '_blank')">Click</button></td>
                </tr>
              `
                      )
                      .join("")
                  : ""
              }
            </tbody>
          `;

          tableDiv.appendChild(table);
          tablesContainer.appendChild(tableDiv);
        });
      }

      function exportData() {
        const data = {
          tables: JSON.parse(localStorage.getItem("tables")) || [],
          links: JSON.parse(localStorage.getItem("links")) || {},
        };
        const blob = new Blob([JSON.stringify(data, null, 2)], {
          type: "application/json",
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "table_data.json";
        a.click();
        URL.revokeObjectURL(url);
      }

      function importData() {
        const fileInput = document.getElementById("importFile");
        fileInput.click();
        fileInput.onchange = function (event) {
          const file = event.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
              try {
                const data = JSON.parse(e.target.result);
                localStorage.setItem("tables", JSON.stringify(data.tables));
                localStorage.setItem("links", JSON.stringify(data.links));
                location.reload();
              } catch (error) {
                alert("à¹„à¸Ÿà¸¥à¹Œà¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡");
              }
            };
            reader.readAsText(file);
          }
        };
      }

      function clearScreen() {
        if (confirm("à¸„à¸¸à¸“à¹à¸™à¹ˆà¹ƒà¸ˆà¸—à¸µà¹ˆà¸ˆà¸°à¸¥à¹‰à¸²à¸‡à¸«à¸™à¹‰à¸²à¸ˆà¸­à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”?")) {
          localStorage.removeItem("tables");
          localStorage.removeItem("links");
          location.reload();
        }
      }

      function logout() {
        if (confirm("à¸„à¸¸à¸“à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸­à¸­à¸à¸ˆà¸²à¸à¸£à¸°à¸šà¸šà¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?")) {
          localStorage.removeItem("loggedIn");
          window.location.href = "login.html";
        }
      }
      function importDefaultData() {
        console.log("â³ à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸” Default Data...");

        fetch("https://pwai1g.github.io/Weblink/Default_List.json", {
          cache: "no-cache",
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error("à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹‚à¸«à¸¥à¸”à¹„à¸Ÿà¸¥à¹Œ Default_List.json à¹„à¸”à¹‰");
            }
            return response.json();
          })
          .then((data) => {
            if (data.tables && data.links) {
              localStorage.setItem("tables", JSON.stringify(data.tables));
              localStorage.setItem("links", JSON.stringify(data.links));

              console.log("âœ… Default Data à¸™à¸³à¹€à¸‚à¹‰à¸²à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢!");
              alert("Import Default à¸ªà¸³à¹€à¸£à¹‡à¸ˆà¹à¸¥à¹‰à¸§!");
              location.reload();
            } else {
              alert("âš ï¸ à¹„à¸Ÿà¸¥à¹Œ Default_List.json à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡!");
            }
          })
          .catch((error) => {
            console.error("âŒ à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸žà¸¥à¸²à¸”:", error);
            alert("à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸žà¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¹‚à¸«à¸¥à¸” Default_List.json");
          });
      }
      function clearCache() {
        const confirmClear = window.confirm(
          "à¸„à¸¸à¸“à¹à¸™à¹ˆà¹ƒà¸ˆà¸—à¸µà¹ˆà¸ˆà¸°à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œà¹à¸„à¸Šà¹à¸¥à¸°à¸£à¸µà¹€à¸‹à¹‡à¸•à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?"
        );

        if (confirmClear) {
          // ðŸ”´ à¸¥à¹‰à¸²à¸‡ Local Storage
          localStorage.removeItem("tables");
          localStorage.removeItem("links");
          localStorage.clear();

          // ðŸ”´ à¸¥à¹‰à¸²à¸‡à¹à¸„à¸Šà¸‚à¸­à¸‡à¹€à¸šà¸£à¸²à¸§à¹Œà¹€à¸‹à¸­à¸£à¹Œ
          caches.keys().then((names) => {
            names.forEach((name) => caches.delete(name));
          });

          // ðŸ”„ à¸£à¸µà¹‚à¸«à¸¥à¸”à¸«à¸™à¹‰à¸²à¹ƒà¸«à¸¡à¹ˆà¹€à¸žà¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¹‚à¸«à¸¥à¸” JSON à¸¥à¹ˆà¸²à¸ªà¸¸à¸”
          location.reload(true);
        }
      }
    </script>
  </body>
</html>
